<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Better Than Nothing CRM</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #F8F9FA;
      color: #212529;
      padding-bottom: 16px;
      -webkit-font-smoothing: antialiased;
    }

    /* Header */
    .header {
      background: white;
      padding: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 18px;
      font-weight: 700;
      color: #2F80ED;
    }

    .logo-icon {
      font-size: 28px;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      line-height: 1.2;
    }

    .logo-main {
      font-size: 16px;
      color: #212529;
    }

    .logo-sub {
      font-size: 11px;
      color: #6C757D;
      font-weight: 500;
    }

    .header h1 {
      font-size: 18px;
      font-weight: 600;
      color: #212529;
    }

    /* Hamburger Menu */
    .hamburger {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
      color: #495057;
      margin-left: -8px;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 150;
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .menu-drawer {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 280px;
      background: white;
      z-index: 200;
      box-shadow: 2px 0 8px rgba(0,0,0,0.2);
      animation: slideInLeft 0.3s ease-out;
    }

    @keyframes slideInLeft {
      from { transform: translateX(-100%); }
      to { transform: translateX(0); }
    }

    .menu-header {
      padding: 24px 16px;
      background: #2F80ED;
      color: white;
    }

    .menu-title {
      font-size: 20px;
      font-weight: 600;
    }

    .menu-items {
      padding: 16px 0;
    }

    .menu-item {
      padding: 16px 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 16px;
      color: #212529;
      transition: background 0.2s;
    }

    .menu-item:hover {
      background: #F8F9FA;
    }

    .menu-item.active {
      background: #E3F2FD;
      color: #2F80ED;
      font-weight: 600;
    }

    .menu-icon {
      font-size: 20px;
    }

    /* Search Bar */
    .search-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .search-input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #DEE2E6;
      border-radius: 8px;
      font-size: 16px;
      background: #F8F9FA;
    }

    .search-input:focus {
      outline: none;
      border-color: #2F80ED;
      background: white;
    }

    /* Filter Chips */
    .filter-chips {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 4px 0;
      -webkit-overflow-scrolling: touch;
    }

    .filter-chips::-webkit-scrollbar {
      display: none;
    }

    .chip {
      padding: 8px 16px;
      border-radius: 20px;
      border: 1px solid #DEE2E6;
      background: white;
      font-size: 14px;
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.2s;
    }

    .chip.active {
      background: #2F80ED;
      color: white;
      border-color: #2F80ED;
    }

    /* Lead List */
    .lead-list {
      padding: 16px;
    }

    .lead-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }

    .lead-card:active {
      transform: scale(0.98);
    }

    .lead-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .lead-name {
      font-size: 18px;
      font-weight: 600;
      color: #212529;
    }


    .lead-phone {
      font-size: 14px;
      color: #495057;
      margin-bottom: 8px;
    }

    .status-badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
    }

    .status-new { background: #E3F2FD; color: #1976D2; }
    .status-in-progress { background: #FFF3E0; color: #F57C00; }
    .status-quoted { background: #F3E5F5; color: #7B1FA2; }
    .status-won { background: #E8F5E9; color: #388E3C; }
    .status-lost { background: #FFEBEE; color: #D32F2F; }

    .new-message-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 8px;
      height: 8px;
      background: #2F80ED;
      border-radius: 50%;
    }

    /* Lead Detail */
    .lead-detail {
      padding: 16px;
    }

    .back-button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
      margin: 0;
      margin-left: -8px;
      margin-right: 4px;
      color: #2F80ED;
    }

    .detail-section {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .detail-section h2 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #212529;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #F8F9FA;
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-size: 14px;
      color: #6C757D;
    }

    .detail-value {
      font-size: 14px;
      color: #212529;
      font-weight: 500;
    }

    .detail-value-input {
      font-size: 14px;
      color: #212529;
      font-weight: 500;
      border: 1px solid #DEE2E6;
      border-radius: 4px;
      padding: 4px 8px;
      background: white;
    }

    .detail-value-input:focus {
      outline: none;
      border-color: #2F80ED;
    }

    .edit-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .btn-small {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-edit {
      background: #2F80ED;
      color: white;
    }

    .btn-cancel {
      background: #F8F9FA;
      color: #495057;
      border: 1px solid #DEE2E6;
    }

    .notes-section {
      margin-top: 12px;
    }

    .notes-content {
      font-size: 14px;
      color: #495057;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .notes-textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #DEE2E6;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      line-height: 1.6;
      resize: vertical;
      min-height: 80px;
    }

    .notes-textarea:focus {
      outline: none;
      border-color: #2F80ED;
    }

    /* Status Selector */
    .status-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .status-button {
      flex: 1;
      min-width: calc(50% - 4px);
      padding: 12px;
      border: 2px solid #DEE2E6;
      border-radius: 8px;
      background: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .status-button.selected {
      border-color: #2F80ED;
      background: #E3F2FD;
      color: #2F80ED;
    }

    /* Chat Section */
    .chat-container {
      max-height: 400px;
      overflow-y: auto;
      padding: 16px;
      background: #F8F9FA;
      border-radius: 12px;
    }

    .chat-message {
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
    }

    .chat-message.ai {
      align-items: flex-start;
    }

    .chat-message.lead {
      align-items: flex-end;
    }

    .message-bubble {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.4;
    }

    .chat-message.ai .message-bubble {
      background: white;
      color: #212529;
      border-bottom-left-radius: 4px;
    }

    .chat-message.lead .message-bubble {
      background: #2F80ED;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message-time {
      font-size: 12px;
      color: #6C757D;
      margin-top: 4px;
    }

    /* Add Lead Form */
    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #495057;
      margin-bottom: 8px;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #DEE2E6;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      background: white;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: #2F80ED;
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #2F80ED;
      color: white;
    }

    .btn-primary:active {
      background: #2566C9;
    }

    .btn-secondary {
      background: #F8F9FA;
      color: #495057;
      border: 1px solid #DEE2E6;
    }

    .fab {
      position: fixed;
      bottom: 24px;
      right: 16px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #2F80ED;
      color: white;
      border: none;
      font-size: 24px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: transform 0.2s;
      z-index: 50;
    }

    .fab:active {
      transform: scale(0.95);
    }


    /* Toast */
    .toast {
      position: fixed;
      top: 80px;
      left: 16px;
      right: 16px;
      background: #212529;
      color: white;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 200;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 48px 16px;
      color: #6C757D;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state-text {
      font-size: 16px;
    }

    /* Review Cards */
    .review-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .review-author {
      font-size: 16px;
      font-weight: 600;
      color: #212529;
      margin-bottom: 4px;
    }

    .review-stars {
      color: #FFC107;
      font-size: 18px;
      letter-spacing: 2px;
    }

    .review-date {
      font-size: 12px;
      color: #6C757D;
      margin-bottom: 8px;
    }

    .review-text {
      font-size: 14px;
      color: #495057;
      line-height: 1.6;
      margin-bottom: 8px;
    }

    .review-service {
      font-size: 12px;
      color: #6C757D;
      font-style: italic;
    }

    /* Modal/Popup */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.6);
      z-index: 250;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      animation: fadeIn 0.2s ease-out;
    }

    .modal {
      background: white;
      border-radius: 12px;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      animation: scaleIn 0.3s ease-out;
    }

    @keyframes scaleIn {
      from {
        transform: scale(0.9);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #DEE2E6;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: #212529;
    }

    .modal-subtitle {
      font-size: 14px;
      color: #6C757D;
      margin-top: 4px;
    }

    .modal-body {
      padding: 16px 20px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid #DEE2E6;
      display: flex;
      gap: 8px;
    }

    .modal-footer .btn {
      flex: 1;
      padding: 12px;
    }

    /* Lead Selection */
    .lead-select-item {
      display: flex;
      align-items: center;
      padding: 12px;
      border: 1px solid #DEE2E6;
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .lead-select-item:hover {
      background: #F8F9FA;
    }

    .lead-select-item.selected {
      background: #E3F2FD;
      border-color: #2F80ED;
    }

    .lead-checkbox {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      cursor: pointer;
    }

    .lead-select-info {
      flex: 1;
    }

    .lead-select-name {
      font-size: 15px;
      font-weight: 600;
      color: #212529;
      margin-bottom: 2px;
    }

    .lead-select-details {
      font-size: 13px;
      color: #6C757D;
    }

    /* Confirmation Dialog */
    .confirmation-dialog {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 400px;
      width: 100%;
      text-align: center;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      animation: scaleIn 0.3s ease-out;
    }

    .confirmation-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .confirmation-title {
      font-size: 20px;
      font-weight: 600;
      color: #212529;
      margin-bottom: 8px;
    }

    .confirmation-message {
      font-size: 14px;
      color: #6C757D;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .confirmation-actions {
      display: flex;
      gap: 8px;
    }

    .confirmation-actions .btn {
      flex: 1;
    }

    /* Get Reviews Button */
    .get-reviews-btn {
      position: fixed;
      bottom: 24px;
      right: 16px;
      padding: 14px 24px;
      background: #2F80ED;
      color: white;
      border: none;
      border-radius: 24px;
      font-size: 15px;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(47, 128, 237, 0.4);
      cursor: pointer;
      transition: all 0.2s;
      z-index: 50;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .get-reviews-btn:active {
      transform: scale(0.95);
    }

    /* Quote Styles */
    .quote-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .quote-card:active {
      transform: scale(0.98);
    }

    .quote-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .quote-number {
      font-size: 14px;
      color: #6C757D;
      font-weight: 600;
    }

    .quote-customer {
      font-size: 18px;
      font-weight: 600;
      color: #212529;
      margin-bottom: 4px;
    }

    .quote-service {
      font-size: 14px;
      color: #495057;
      margin-bottom: 8px;
    }

    .quote-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #F8F9FA;
    }

    .quote-amount {
      font-size: 20px;
      font-weight: 700;
      color: #2F80ED;
    }

    .quote-date {
      font-size: 12px;
      color: #6C757D;
    }

    .status-sent { background: #E3F2FD; color: #1976D2; }
    .status-accepted { background: #E8F5E9; color: #388E3C; }
    .status-pending { background: #FFF3E0; color: #F57C00; }
    .status-declined { background: #FFEBEE; color: #D32F2F; }
    .status-paid { background: #E8F5E9; color: #2E7D32; }

    .quote-detail-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .quote-stat-card {
      background: #F8F9FA;
      padding: 12px;
      border-radius: 8px;
    }

    .quote-stat-label {
      font-size: 12px;
      color: #6C757D;
      margin-bottom: 4px;
    }

    .quote-stat-value {
      font-size: 18px;
      font-weight: 600;
      color: #212529;
    }

    .line-items {
      margin-top: 12px;
    }

    .line-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #F8F9FA;
    }

    .line-item:last-child {
      border-bottom: none;
    }

    .line-item-desc {
      flex: 1;
    }

    .line-item-title {
      font-size: 14px;
      font-weight: 600;
      color: #212529;
      margin-bottom: 2px;
    }

    .line-item-subtitle {
      font-size: 12px;
      color: #6C757D;
    }

    .line-item-price {
      font-size: 16px;
      font-weight: 600;
      color: #212529;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .action-buttons .btn {
      flex: 1;
    }

    .btn-outline {
      background: white;
      color: #2F80ED;
      border: 2px solid #2F80ED;
    }

    .btn-outline:active {
      background: #E3F2FD;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Toast Notification -->
    <div v-if="toast.show" class="toast">
      {{ toast.message }}
    </div>

    <!-- Hamburger Menu -->
    <div v-if="menuOpen" class="menu-overlay" @click="menuOpen = false"></div>
    <div v-if="menuOpen" class="menu-drawer">
      <div class="menu-header">
        <div class="menu-title">Menu</div>
      </div>
      <div class="menu-items">
        <div class="menu-item" :class="{ active: currentView === 'list' }" @click="navigateTo('list')">
          <span class="menu-icon">üìã</span>
          <span>Leads</span>
        </div>
        <div class="menu-item" :class="{ active: currentView === 'quotes' || currentView === 'quote-detail' || currentView === 'add-quote' }" @click="navigateTo('quotes')">
          <span class="menu-icon">üí∞</span>
          <span>Quotes</span>
        </div>
        <div class="menu-item" :class="{ active: currentView === 'reviews' }" @click="navigateTo('reviews')">
          <span class="menu-icon">‚≠ê</span>
          <span>Reviews</span>
        </div>
      </div>
    </div>

    <!-- Header -->
    <div class="header">
      <!-- Main views with hamburger menu -->
      <div class="header-top" v-if="currentView === 'list' || currentView === 'reviews' || currentView === 'quotes'">
        <div class="header-left">
          <button class="hamburger" @click="menuOpen = !menuOpen">‚ò∞</button>
          <div class="logo">
            <span class="logo-icon">üå≥</span>
            <div class="logo-text">
              <span class="logo-main">TreePro</span>
              <span class="logo-sub">Tree Services</span>
            </div>
          </div>
        </div>
        <h1 v-if="currentView === 'list'">Leads</h1>
        <h1 v-else-if="currentView === 'quotes'">Quotes</h1>
        <h1 v-else-if="currentView === 'reviews'">Reviews</h1>
      </div>

      <!-- Add Lead view -->
      <div class="header-top" v-else-if="currentView === 'add'">
        <div class="header-left">
          <button class="back-button" @click="cancelAddLead">‚Üê</button>
          <div class="logo">
            <span class="logo-icon">üå≥</span>
            <div class="logo-text">
              <span class="logo-main">TreePro</span>
              <span class="logo-sub">Tree Services</span>
            </div>
          </div>
        </div>
        <h1>Add Lead</h1>
      </div>

      <!-- Add Quote view -->
      <div class="header-top" v-else-if="currentView === 'add-quote'">
        <div class="header-left">
          <button class="back-button" @click="cancelAddQuote">‚Üê</button>
          <div class="logo">
            <span class="logo-icon">üå≥</span>
            <div class="logo-text">
              <span class="logo-main">TreePro</span>
              <span class="logo-sub">Tree Services</span>
            </div>
          </div>
        </div>
        <h1>Create Quote</h1>
      </div>

      <!-- Detail view with back button -->
      <div class="header-top" v-else-if="currentView === 'detail'">
        <div class="header-left">
          <button class="back-button" @click="currentView = 'list'">‚Üê</button>
          <div class="logo">
            <span class="logo-icon">üå≥</span>
            <div class="logo-text">
              <span class="logo-main">TreePro</span>
              <span class="logo-sub">Tree Services</span>
            </div>
          </div>
        </div>
        <h1>Details</h1>
      </div>

      <!-- Quote Detail view with back button -->
      <div class="header-top" v-else-if="currentView === 'quote-detail'">
        <div class="header-left">
          <button class="back-button" @click="currentView = 'quotes'">‚Üê</button>
          <div class="logo">
            <span class="logo-icon">üå≥</span>
            <div class="logo-text">
              <span class="logo-main">TreePro</span>
              <span class="logo-sub">Tree Services</span>
            </div>
          </div>
        </div>
        <h1>Quote Details</h1>
      </div>

      <!-- Search & Filter (only on list view) -->
      <div v-if="currentView === 'list'">
        <div class="search-bar">
          <input
            type="text"
            class="search-input"
            placeholder="Search leads..."
            v-model="searchQuery"
          >
        </div>
        <div class="filter-chips">
          <div
            class="chip"
            :class="{ active: filterStatus === 'all' }"
            @click="filterStatus = 'all'"
          >
            All
          </div>
          <div
            class="chip"
            :class="{ active: filterStatus === 'New' }"
            @click="filterStatus = 'New'"
          >
            New
          </div>
          <div
            class="chip"
            :class="{ active: filterStatus === 'In Progress' }"
            @click="filterStatus = 'In Progress'"
          >
            In Progress
          </div>
          <div
            class="chip"
            :class="{ active: filterStatus === 'Quoted' }"
            @click="filterStatus = 'Quoted'"
          >
            Quoted
          </div>
          <div
            class="chip"
            :class="{ active: filterStatus === 'Won' }"
            @click="filterStatus = 'Won'"
          >
            Won
          </div>
          <div
            class="chip"
            :class="{ active: filterStatus === 'Lost' }"
            @click="filterStatus = 'Lost'"
          >
            Lost
          </div>
        </div>
      </div>
    </div>

    <!-- Lead List View -->
    <div v-if="currentView === 'list'" class="lead-list">
      <div v-if="filteredLeads.length === 0" class="empty-state">
        <div class="empty-state-icon">üìã</div>
        <div class="empty-state-text">No leads found</div>
      </div>
      <div
        v-for="lead in filteredLeads"
        :key="lead.id"
        class="lead-card"
        @click="viewLeadDetail(lead.id)"
      >
        <div v-if="lead.hasNewMessages" class="new-message-badge"></div>
        <div class="lead-card-header">
          <div>
            <div class="lead-name">{{ lead.name }}</div>
          </div>
          <span class="status-badge" :class="getStatusClass(lead.status)">
            {{ lead.status }}
          </span>
        </div>
        <div class="lead-phone">üìû {{ lead.phone }}</div>
      </div>
    </div>

    <!-- Lead Detail View -->
    <div v-if="currentView === 'detail'" class="lead-detail">
      <div v-if="selectedLead" class="detail-section">
        <h2>Contact Information</h2>

        <!-- View Mode -->
        <div v-if="!editMode.contact">
          <div class="detail-row">
            <span class="detail-label">Name</span>
            <span class="detail-value">{{ selectedLead.name }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone</span>
            <span class="detail-value">{{ selectedLead.phone }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Email</span>
            <span class="detail-value">{{ selectedLead.email }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Source</span>
            <span class="detail-value">{{ selectedLead.source || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Service Type</span>
            <span class="detail-value">{{ selectedLead.serviceType }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Date Added</span>
            <span class="detail-value">{{ formatDate(selectedLead.dateAdded) }}</span>
          </div>
          <div class="edit-actions">
            <button class="btn-small btn-edit" @click="startEditContact">Edit</button>
          </div>
        </div>

        <!-- Edit Mode -->
        <div v-else>
          <div class="detail-row">
            <span class="detail-label">Name</span>
            <input type="text" class="detail-value-input" v-model="editData.name">
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone</span>
            <input type="tel" class="detail-value-input" v-model="editData.phone">
          </div>
          <div class="detail-row">
            <span class="detail-label">Email</span>
            <input type="email" class="detail-value-input" v-model="editData.email">
          </div>
          <div class="detail-row">
            <span class="detail-label">Source</span>
            <input type="text" class="detail-value-input" v-model="editData.source" placeholder="e.g. Google, Referral">
          </div>
          <div class="detail-row">
            <span class="detail-label">Service Type</span>
            <input type="text" class="detail-value-input" v-model="editData.serviceType">
          </div>
          <div class="edit-actions">
            <button class="btn-small btn-edit" @click="saveContactEdits">Save</button>
            <button class="btn-small btn-cancel" @click="cancelEditContact">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Notes Section -->
      <div v-if="selectedLead" class="detail-section">
        <h2>Notes</h2>

        <!-- View Mode -->
        <div v-if="!editMode.notes">
          <div class="notes-content">{{ selectedLead.notes || 'No notes yet' }}</div>
          <div class="edit-actions">
            <button class="btn-small btn-edit" @click="startEditNotes">Edit</button>
          </div>
        </div>

        <!-- Edit Mode -->
        <div v-else>
          <textarea class="notes-textarea" v-model="editData.notes" placeholder="Add notes..."></textarea>
          <div class="edit-actions">
            <button class="btn-small btn-edit" @click="saveNotesEdits">Save</button>
            <button class="btn-small btn-cancel" @click="cancelEditNotes">Cancel</button>
          </div>
        </div>
      </div>

      <div v-if="selectedLead" class="detail-section">
        <h2>Status</h2>
        <div class="status-selector">
          <button
            v-for="status in statuses"
            :key="status"
            class="status-button"
            :class="{ selected: selectedLead.status === status }"
            @click="updateLeadStatus(status)"
          >
            {{ status }}
          </button>
        </div>
      </div>

      <div v-if="selectedLead && selectedLead.conversation" class="detail-section">
        <h2>AI Conversation</h2>
        <div class="chat-container">
          <div
            v-for="(message, index) in selectedLead.conversation"
            :key="index"
            class="chat-message"
            :class="message.sender"
          >
            <div class="message-bubble">
              {{ message.text }}
            </div>
            <div class="message-time">
              {{ formatTime(message.timestamp) }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Lead View -->
    <div v-if="currentView === 'add'" class="lead-detail">
      <div class="detail-section">
        <div class="form-group">
          <label class="form-label">Name *</label>
          <input
            type="text"
            class="form-input"
            placeholder="John Doe"
            v-model="newLead.name"
          >
        </div>

        <div class="form-group">
          <label class="form-label">Phone *</label>
          <input
            type="tel"
            class="form-input"
            placeholder="(555) 123-4567"
            v-model="newLead.phone"
          >
        </div>

        <div class="form-group">
          <label class="form-label">Email</label>
          <input
            type="email"
            class="form-input"
            placeholder="john@example.com"
            v-model="newLead.email"
          >
        </div>

        <div class="form-group">
          <label class="form-label">Source</label>
          <input
            type="text"
            class="form-input"
            placeholder="Google, Referral, etc."
            v-model="newLead.source"
          >
        </div>

        <div class="form-group">
          <label class="form-label">Service Type</label>
          <input
            type="text"
            class="form-input"
            placeholder="Plumbing, HVAC, etc."
            v-model="newLead.serviceType"
          >
        </div>

        <div class="form-group">
          <label class="form-label">Status</label>
          <select class="form-select" v-model="newLead.status">
            <option v-for="status in statuses" :key="status" :value="status">
              {{ status }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea
            class="form-textarea"
            placeholder="Additional information..."
            v-model="newLead.notes"
          ></textarea>
        </div>

        <button class="btn btn-primary" @click="saveLead">
          Add Lead
        </button>
        <button class="btn btn-secondary" @click="cancelAddLead" style="margin-top: 8px;">
          Cancel
        </button>
      </div>
    </div>

    <!-- FAB Button -->
    <button v-if="currentView === 'list'" class="fab" @click="currentView = 'add'">
      +
    </button>

    <!-- Reviews View -->
    <div v-if="currentView === 'reviews'" class="lead-list">
      <div v-if="reviews.length === 0" class="empty-state">
        <div class="empty-state-icon">‚≠ê</div>
        <div class="empty-state-text">No reviews yet</div>
      </div>
      <div v-else>
        <div v-for="review in reviews" :key="review.id" class="review-card">
          <div class="review-header">
            <div>
              <div class="review-author">{{ review.author }}</div>
              <div class="review-stars">{{ getStars(review.rating) }}</div>
            </div>
          </div>
          <div class="review-date">{{ formatDate(review.date) }}</div>
          <div class="review-text">{{ review.text }}</div>
          <div class="review-service">{{ review.serviceType }}</div>
        </div>
      </div>
    </div>

    <!-- Get More Reviews Button -->
    <button v-if="currentView === 'reviews'" class="get-reviews-btn" @click="showReviewRequestModal = true">
      <span>‚úâÔ∏è</span>
      <span>Get More Reviews</span>
    </button>

    <!-- Review Request Modal -->
    <div v-if="showReviewRequestModal" class="modal-overlay" @click="closeReviewModal">
      <div class="modal" @click.stop>
        <div class="modal-header">
          <div class="modal-title">Request Reviews</div>
          <div class="modal-subtitle">Select customers to send review requests</div>
        </div>
        <div class="modal-body">
          <div v-if="leads.length === 0" class="empty-state">
            <div class="empty-state-text">No leads to request reviews from</div>
          </div>
          <div v-else>
            <div
              v-for="lead in leads"
              :key="lead.id"
              class="lead-select-item"
              :class="{ selected: selectedLeadsForReview.includes(lead.id) }"
              @click="toggleLeadSelection(lead.id)"
            >
              <input
                type="checkbox"
                class="lead-checkbox"
                :checked="selectedLeadsForReview.includes(lead.id)"
                @click.stop="toggleLeadSelection(lead.id)"
              >
              <div class="lead-select-info">
                <div class="lead-select-name">{{ lead.name }}</div>
                <div class="lead-select-details">{{ lead.serviceType }} ‚Ä¢ {{ lead.phone }}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" @click="closeReviewModal">Cancel</button>
          <button
            class="btn btn-primary"
            @click="confirmReviewRequest"
            :disabled="selectedLeadsForReview.length === 0"
          >
            Request Reviews ({{ selectedLeadsForReview.length }})
          </button>
        </div>
      </div>
    </div>

    <!-- Quotes List View -->
    <div v-if="currentView === 'quotes'" class="lead-list">
      <div v-if="quotes.length === 0" class="empty-state">
        <div class="empty-state-icon">üí∞</div>
        <div class="empty-state-text">No quotes yet</div>
      </div>
      <div v-else>
        <div v-for="quote in quotes" :key="quote.id" class="quote-card" @click="viewQuoteDetail(quote.id)">
          <div class="quote-header">
            <div>
              <div class="quote-number">Quote #{{ quote.number }}</div>
              <div class="quote-customer">{{ quote.customerName }}</div>
            </div>
            <span class="status-badge" :class="'status-' + quote.status.toLowerCase()">
              {{ quote.status }}
            </span>
          </div>
          <div class="quote-service">{{ quote.serviceType }}</div>
          <div class="quote-footer">
            <div class="quote-amount">${{ formatMoney(quote.total) }}</div>
            <div class="quote-date">{{ formatDate(quote.dateCreated) }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Quote FAB -->
    <button v-if="currentView === 'quotes'" class="fab" @click="currentView = 'add-quote'">
      +
    </button>

    <!-- Quote Detail View -->
    <div v-if="currentView === 'quote-detail'" class="lead-detail">
      <div v-if="selectedQuote" class="detail-section">
        <div class="quote-detail-grid">
          <div class="quote-stat-card">
            <div class="quote-stat-label">Quote #</div>
            <div class="quote-stat-value">{{ selectedQuote.number }}</div>
          </div>
          <div class="quote-stat-card">
            <div class="quote-stat-label">Status</div>
            <div class="quote-stat-value" :style="{ color: getQuoteStatusColor(selectedQuote.status) }">
              {{ selectedQuote.status }}
            </div>
          </div>
          <div class="quote-stat-card">
            <div class="quote-stat-label">Date Created</div>
            <div class="quote-stat-value" style="font-size: 14px;">{{ formatDate(selectedQuote.dateCreated) }}</div>
          </div>
          <div class="quote-stat-card">
            <div class="quote-stat-label">Valid Until</div>
            <div class="quote-stat-value" style="font-size: 14px;">{{ formatDate(selectedQuote.validUntil) }}</div>
          </div>
        </div>
      </div>

      <div v-if="selectedQuote" class="detail-section">
        <h2>Customer Information</h2>
        <div class="detail-row">
          <span class="detail-label">Name</span>
          <span class="detail-value">{{ selectedQuote.customerName }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Phone</span>
          <span class="detail-value">{{ selectedQuote.phone }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Email</span>
          <span class="detail-value">{{ selectedQuote.email }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Service</span>
          <span class="detail-value">{{ selectedQuote.serviceType }}</span>
        </div>
      </div>

      <div v-if="selectedQuote" class="detail-section">
        <h2>Line Items</h2>
        <div class="line-items">
          <div v-for="(item, index) in selectedQuote.lineItems" :key="index" class="line-item">
            <div class="line-item-desc">
              <div class="line-item-title">{{ item.description }}</div>
              <div class="line-item-subtitle" v-if="item.quantity">Qty: {{ item.quantity }}</div>
            </div>
            <div class="line-item-price">${{ formatMoney(item.price) }}</div>
          </div>
        </div>
        <div class="line-item" style="border-top: 2px solid #212529; margin-top: 8px; padding-top: 16px;">
          <div class="line-item-title">Total</div>
          <div class="quote-amount">${{ formatMoney(selectedQuote.total) }}</div>
        </div>
      </div>

      <div v-if="selectedQuote" class="detail-section">
        <h2>Notes</h2>
        <div class="notes-content">{{ selectedQuote.notes || 'No notes' }}</div>
      </div>

      <div v-if="selectedQuote" class="detail-section">
        <h2>Actions</h2>
        <div class="action-buttons">
          <button class="btn btn-outline" @click="sendQuoteFollowUp">
            üìß Send Follow-Up
          </button>
          <button class="btn btn-outline" @click="requestPayment" v-if="selectedQuote.status === 'Accepted'">
            üí≥ Request Payment
          </button>
        </div>
        <div class="action-buttons" style="margin-top: 8px;">
          <button class="btn btn-secondary" @click="markQuoteStatus('Accepted')" v-if="selectedQuote.status === 'Sent'">
            ‚úÖ Mark Accepted
          </button>
          <button class="btn btn-secondary" @click="markQuoteStatus('Declined')" v-if="selectedQuote.status === 'Sent'">
            ‚ùå Mark Declined
          </button>
          <button class="btn btn-primary" @click="markQuoteStatus('Paid')" v-if="selectedQuote.status === 'Accepted'">
            üí∞ Mark as Paid
          </button>
        </div>
      </div>
    </div>

    <!-- Add Quote View -->
    <div v-if="currentView === 'add-quote'" class="lead-detail">
      <div class="detail-section">
        <h2>Customer Information</h2>
        <div class="form-group">
          <label class="form-label">Select Lead</label>
          <select class="form-select" v-model="newQuote.leadId" @change="populateFromLead">
            <option value="">-- Select a lead --</option>
            <option v-for="lead in leads" :key="lead.id" :value="lead.id">
              {{ lead.name }} - {{ lead.serviceType }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Customer Name *</label>
          <input type="text" class="form-input" v-model="newQuote.customerName" placeholder="John Doe">
        </div>

        <div class="form-group">
          <label class="form-label">Phone *</label>
          <input type="tel" class="form-input" v-model="newQuote.phone" placeholder="(555) 123-4567">
        </div>

        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" v-model="newQuote.email" placeholder="john@example.com">
        </div>

        <div class="form-group">
          <label class="form-label">Service Type *</label>
          <input type="text" class="form-input" v-model="newQuote.serviceType" placeholder="Tree Trimming">
        </div>
      </div>

      <div class="detail-section">
        <h2>Quote Details</h2>
        <div class="form-group">
          <label class="form-label">Description *</label>
          <textarea class="form-textarea" v-model="newQuote.description" placeholder="Describe the work to be done..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Amount *</label>
          <input type="number" class="form-input" v-model="newQuote.amount" placeholder="0.00" step="0.01">
        </div>

        <div class="form-group">
          <label class="form-label">Valid Until</label>
          <input type="date" class="form-input" v-model="newQuote.validUntil">
        </div>

        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-textarea" v-model="newQuote.notes" placeholder="Additional notes..."></textarea>
        </div>

        <button class="btn btn-primary" @click="saveQuote">
          Create Quote
        </button>
        <button class="btn btn-secondary" @click="cancelAddQuote" style="margin-top: 8px;">
          Cancel
        </button>
      </div>
    </div>

    <!-- Confirmation Dialog -->
    <div v-if="showConfirmation" class="modal-overlay" @click="closeConfirmation">
      <div class="confirmation-dialog" @click.stop>
        <div class="confirmation-icon">‚úÖ</div>
        <div class="confirmation-title">Review Requests Sent!</div>
        <div class="confirmation-message">
          {{ confirmationMessage }}
        </div>
        <div class="confirmation-actions">
          <button class="btn btn-primary" @click="closeConfirmation">Done</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          currentView: 'list', // 'list', 'detail', 'add', 'reviews', 'quotes', 'quote-detail', 'add-quote'
          searchQuery: '',
          filterStatus: 'all',
          selectedLeadId: null,
          selectedQuoteId: null,
          menuOpen: false,
          showReviewRequestModal: false,
          showConfirmation: false,
          selectedLeadsForReview: [],
          confirmationMessage: '',
          statuses: ['New', 'In Progress', 'Quoted', 'Won', 'Lost'],
          editMode: {
            contact: false,
            notes: false
          },
          editData: {
            name: '',
            phone: '',
            email: '',
            source: '',
            serviceType: '',
            notes: ''
          },
          toast: {
            show: false,
            message: ''
          },
          newLead: {
            name: '',
            phone: '',
            email: '',
            source: '',
            serviceType: '',
            status: 'New',
            notes: ''
          },
          newQuote: {
            leadId: '',
            customerName: '',
            phone: '',
            email: '',
            serviceType: '',
            description: '',
            amount: '',
            validUntil: '',
            notes: ''
          },
          quotes: [
            {
              id: 1,
              number: '1001',
              customerName: 'Sarah Johnson',
              phone: '(555) 234-5678',
              email: 'sarah@johnsonassoc.com',
              serviceType: 'Tree Trimming',
              status: 'Sent',
              dateCreated: '2025-11-01T09:00:00',
              validUntil: '2025-11-15T23:59:59',
              lineItems: [
                { description: 'Tree trimming - 3 large oak trees', quantity: 3, price: 450 },
                { description: 'Branch removal and disposal', quantity: 1, price: 150 },
                { description: 'Cleanup and debris removal', quantity: 1, price: 100 }
              ],
              total: 700,
              notes: 'Customer requested work to be done on weekends only'
            },
            {
              id: 2,
              number: '1002',
              customerName: 'Michael Chen',
              phone: '(555) 876-5432',
              email: 'mchen@email.com',
              serviceType: 'Stump Removal',
              status: 'Accepted',
              dateCreated: '2025-10-28T14:30:00',
              validUntil: '2025-11-12T23:59:59',
              lineItems: [
                { description: 'Stump grinding - Large maple (24" diameter)', quantity: 1, price: 350 },
                { description: 'Fill and level area', quantity: 1, price: 75 }
              ],
              total: 425,
              notes: 'Payment due upon completion'
            },
            {
              id: 3,
              number: '1003',
              customerName: 'Emily Rodriguez',
              phone: '(555) 345-6789',
              email: 'emily@rodriguezconst.com',
              serviceType: 'Tree Removal',
              status: 'Paid',
              dateCreated: '2025-10-20T11:00:00',
              validUntil: '2025-11-05T23:59:59',
              lineItems: [
                { description: 'Emergency tree removal - Storm damaged pine', quantity: 1, price: 1200 },
                { description: 'Crane rental and operation', quantity: 1, price: 500 },
                { description: 'Disposal fees', quantity: 1, price: 150 }
              ],
              total: 1850,
              notes: 'Job completed 10/25. Payment received via check.'
            },
            {
              id: 4,
              number: '1004',
              customerName: 'David Thompson',
              phone: '(555) 567-8901',
              email: 'dthompson@email.com',
              serviceType: 'Tree Health Assessment',
              status: 'Declined',
              dateCreated: '2025-10-15T10:15:00',
              validUntil: '2025-10-30T23:59:59',
              lineItems: [
                { description: 'Arborist inspection - 5 trees', quantity: 5, price: 125 },
                { description: 'Written health report', quantity: 1, price: 75 }
              ],
              total: 200,
              notes: 'Customer decided to go with another arborist'
            }
          ],
          reviews: [
            {
              id: 1,
              author: 'David Thompson',
              rating: 5,
              date: '2025-10-30T14:20:00',
              text: 'Outstanding service! They installed my new water heater quickly and professionally. The technician was punctual, cleaned up after the job, and explained everything clearly. Highly recommend!',
              serviceType: 'Plumbing'
            },
            {
              id: 2,
              author: 'Jennifer Martinez',
              rating: 5,
              date: '2025-10-28T10:15:00',
              text: 'Best HVAC company I\'ve worked with! They were able to squeeze me in for an emergency AC repair during a heat wave. Very fair pricing and excellent customer service.',
              serviceType: 'HVAC'
            },
            {
              id: 3,
              author: 'Robert Kim',
              rating: 4,
              date: '2025-10-25T16:45:00',
              text: 'Great experience overall. The electrician was knowledgeable and fixed our panel issue efficiently. Only minor complaint was they arrived 15 minutes late, but they called ahead to let us know.',
              serviceType: 'Electrical'
            },
            {
              id: 4,
              author: 'Amanda Foster',
              rating: 5,
              date: '2025-10-22T09:30:00',
              text: 'I can\'t say enough good things! They helped us with a complete bathroom renovation and the results are stunning. Professional, on time, and within budget. Will definitely use them again!',
              serviceType: 'Plumbing'
            },
            {
              id: 5,
              author: 'Carlos Hernandez',
              rating: 5,
              date: '2025-10-20T11:00:00',
              text: 'Exceptional work! They replaced our old furnace with a new energy-efficient model. The team was courteous, explained all options clearly, and left everything spotless. 10/10 would recommend.',
              serviceType: 'HVAC'
            }
          ],
          leads: [
            {
              id: 1,
              name: 'Sarah Johnson',
              phone: '(555) 234-5678',
              email: 'sarah@johnsonassoc.com',
              status: 'New',
              source: 'Google Ads',
              serviceType: 'Plumbing',
              dateAdded: '2025-11-04T10:30:00',
              hasNewMessages: true,
              notes: 'Interested in full bathroom renovation. Budget: $15,000',
              conversation: [
                {
                  sender: 'ai',
                  text: 'Hi Sarah! Thanks for reaching out. I understand you need plumbing services. Can you tell me more about what you need?',
                  timestamp: '2025-11-04T10:30:00'
                },
                {
                  sender: 'lead',
                  text: 'Yes, we need a complete bathroom renovation for our office building.',
                  timestamp: '2025-11-04T10:35:00'
                },
                {
                  sender: 'ai',
                  text: 'Great! I\'ve noted that down. What\'s your timeline for this project?',
                  timestamp: '2025-11-04T10:36:00'
                },
                {
                  sender: 'lead',
                  text: 'Looking to start within the next 3-4 weeks if possible.',
                  timestamp: '2025-11-04T10:40:00'
                }
              ]
            },
            {
              id: 2,
              name: 'Michael Chen',
              phone: '(555) 876-5432',
              email: 'mchen@email.com',
              status: 'In Progress',
              source: 'Referral',
              serviceType: 'HVAC',
              dateAdded: '2025-11-03T14:20:00',
              hasNewMessages: false,
              notes: 'AC unit replacement needed urgently',
              conversation: [
                {
                  sender: 'ai',
                  text: 'Hello Michael! I see you need HVAC service. What can we help you with?',
                  timestamp: '2025-11-03T14:20:00'
                },
                {
                  sender: 'lead',
                  text: 'My AC stopped working yesterday. It\'s really hot!',
                  timestamp: '2025-11-03T14:22:00'
                },
                {
                  sender: 'ai',
                  text: 'I understand the urgency. Let me connect you with our team for a same-day assessment.',
                  timestamp: '2025-11-03T14:23:00'
                }
              ]
            },
            {
              id: 3,
              name: 'Emily Rodriguez',
              phone: '(555) 345-6789',
              email: 'emily@rodriguezconst.com',
              status: 'Quoted',
              source: 'Website',
              serviceType: 'Electrical',
              dateAdded: '2025-11-02T09:15:00',
              hasNewMessages: true,
              notes: 'Commercial electrical upgrade project',
              conversation: [
                {
                  sender: 'ai',
                  text: 'Hi Emily! How can we assist with your electrical needs?',
                  timestamp: '2025-11-02T09:15:00'
                },
                {
                  sender: 'lead',
                  text: 'We have a commercial building that needs a complete electrical panel upgrade.',
                  timestamp: '2025-11-02T09:20:00'
                }
              ]
            },
            {
              id: 4,
              name: 'David Thompson',
              phone: '(555) 567-8901',
              email: 'dthompson@email.com',
              status: 'Won',
              source: 'Facebook',
              serviceType: 'Plumbing',
              dateAdded: '2025-10-28T11:45:00',
              hasNewMessages: false,
              notes: 'Water heater installation - Scheduled for next Tuesday',
              conversation: [
                {
                  sender: 'ai',
                  text: 'Hi David! What plumbing service do you need?',
                  timestamp: '2025-10-28T11:45:00'
                },
                {
                  sender: 'lead',
                  text: 'Need a new water heater installed.',
                  timestamp: '2025-10-28T11:50:00'
                },
                {
                  sender: 'ai',
                  text: 'Perfect! We can schedule that for you. Does next Tuesday work?',
                  timestamp: '2025-10-28T11:52:00'
                },
                {
                  sender: 'lead',
                  text: 'Yes, Tuesday morning would be great!',
                  timestamp: '2025-10-28T12:00:00'
                }
              ]
            },
            {
              id: 5,
              name: 'Lisa Martinez',
              phone: '(555) 789-0123',
              email: 'lisa@martinezre.com',
              status: 'Lost',
              source: 'Yelp',
              serviceType: 'HVAC',
              dateAdded: '2025-10-25T16:30:00',
              hasNewMessages: false,
              notes: 'Went with another contractor - price too high',
              conversation: [
                {
                  sender: 'ai',
                  text: 'Hi Lisa! I understand you need HVAC services for multiple properties?',
                  timestamp: '2025-10-25T16:30:00'
                },
                {
                  sender: 'lead',
                  text: 'Yes, we have 5 rental properties that need maintenance.',
                  timestamp: '2025-10-25T16:35:00'
                },
                {
                  sender: 'ai',
                  text: 'Great! I\'ll have our team prepare a quote for you.',
                  timestamp: '2025-10-25T16:40:00'
                }
              ]
            },
            {
              id: 6,
              name: 'James Wilson',
              phone: '(555) 432-1098',
              email: 'jwilson@email.com',
              status: 'New',
              source: 'Google Search',
              serviceType: 'Electrical',
              dateAdded: '2025-11-05T08:00:00',
              hasNewMessages: true,
              notes: 'Urgent: Power outage in home office',
              conversation: [
                {
                  sender: 'ai',
                  text: 'Good morning James! What electrical issue can we help you with?',
                  timestamp: '2025-11-05T08:00:00'
                },
                {
                  sender: 'lead',
                  text: 'My home office has no power. I work from home and need this fixed ASAP!',
                  timestamp: '2025-11-05T08:05:00'
                }
              ]
            }
          ]
        };
      },
      computed: {
        filteredLeads() {
          let filtered = this.leads;

          // Filter by status
          if (this.filterStatus !== 'all') {
            filtered = filtered.filter(lead => lead.status === this.filterStatus);
          }

          // Search filter
          if (this.searchQuery.trim()) {
            const query = this.searchQuery.toLowerCase();
            filtered = filtered.filter(lead =>
              lead.name.toLowerCase().includes(query) ||
              lead.phone.includes(query) ||
              lead.email.toLowerCase().includes(query) ||
              (lead.source && lead.source.toLowerCase().includes(query))
            );
          }

          return filtered;
        },
        selectedLead() {
          return this.leads.find(lead => lead.id === this.selectedLeadId);
        },
        selectedQuote() {
          return this.quotes.find(quote => quote.id === this.selectedQuoteId);
        }
      },
      methods: {
        navigateTo(view) {
          this.currentView = view;
          this.menuOpen = false;
        },
        getStatusClass(status) {
          return 'status-' + status.toLowerCase().replace(' ', '-');
        },
        viewLeadDetail(leadId) {
          this.selectedLeadId = leadId;
          this.currentView = 'detail';
          this.editMode.contact = false;
          this.editMode.notes = false;
          // Mark messages as read
          const lead = this.leads.find(l => l.id === leadId);
          if (lead) {
            lead.hasNewMessages = false;
          }
        },
        updateLeadStatus(newStatus) {
          if (this.selectedLead) {
            this.selectedLead.status = newStatus;
            this.showToast(`Status updated to ${newStatus}`);
          }
        },
        startEditContact() {
          this.editData.name = this.selectedLead.name;
          this.editData.phone = this.selectedLead.phone;
          this.editData.email = this.selectedLead.email;
          this.editData.source = this.selectedLead.source || '';
          this.editData.serviceType = this.selectedLead.serviceType;
          this.editMode.contact = true;
        },
        saveContactEdits() {
          if (!this.editData.name.trim() || !this.editData.phone.trim()) {
            this.showToast('Name and phone are required');
            return;
          }
          this.selectedLead.name = this.editData.name;
          this.selectedLead.phone = this.editData.phone;
          this.selectedLead.email = this.editData.email;
          this.selectedLead.source = this.editData.source;
          this.selectedLead.serviceType = this.editData.serviceType;
          this.editMode.contact = false;
          this.showToast('Contact information updated');
        },
        cancelEditContact() {
          this.editMode.contact = false;
        },
        startEditNotes() {
          this.editData.notes = this.selectedLead.notes || '';
          this.editMode.notes = true;
        },
        saveNotesEdits() {
          this.selectedLead.notes = this.editData.notes;
          this.editMode.notes = false;
          this.showToast('Notes updated');
        },
        cancelEditNotes() {
          this.editMode.notes = false;
        },
        saveLead() {
          // Validate required fields
          if (!this.newLead.name.trim() || !this.newLead.phone.trim()) {
            this.showToast('Please fill in required fields');
            return;
          }

          // Create new lead
          const lead = {
            id: this.leads.length + 1,
            name: this.newLead.name,
            phone: this.newLead.phone,
            email: this.newLead.email || 'N/A',
            source: this.newLead.source,
            status: this.newLead.status,
            serviceType: this.newLead.serviceType || 'General',
            dateAdded: new Date().toISOString(),
            hasNewMessages: false,
            notes: this.newLead.notes,
            conversation: []
          };

          this.leads.unshift(lead);
          this.showToast('Lead added successfully!');
          this.currentView = 'list';
          this.resetNewLead();
        },
        cancelAddLead() {
          this.currentView = 'list';
          this.resetNewLead();
        },
        resetNewLead() {
          this.newLead = {
            name: '',
            phone: '',
            email: '',
            source: '',
            serviceType: '',
            status: 'New',
            notes: ''
          };
        },
        showToast(message) {
          this.toast.message = message;
          this.toast.show = true;
          setTimeout(() => {
            this.toast.show = false;
          }, 3000);
        },
        formatDate(dateString) {
          const date = new Date(dateString);
          return date.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric',
            year: 'numeric'
          });
        },
        formatTime(dateString) {
          const date = new Date(dateString);
          return date.toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          });
        },
        getStars(rating) {
          return '‚≠ê'.repeat(rating);
        },
        toggleLeadSelection(leadId) {
          const index = this.selectedLeadsForReview.indexOf(leadId);
          if (index > -1) {
            this.selectedLeadsForReview.splice(index, 1);
          } else {
            this.selectedLeadsForReview.push(leadId);
          }
        },
        closeReviewModal() {
          this.showReviewRequestModal = false;
          this.selectedLeadsForReview = [];
        },
        confirmReviewRequest() {
          const count = this.selectedLeadsForReview.length;
          const selectedNames = this.selectedLeadsForReview
            .map(id => this.leads.find(lead => lead.id === id)?.name)
            .filter(name => name);

          this.confirmationMessage = `Review requests have been sent to ${count} customer${count > 1 ? 's' : ''}: ${selectedNames.join(', ')}`;

          this.showReviewRequestModal = false;
          this.showConfirmation = true;
          this.selectedLeadsForReview = [];
        },
        closeConfirmation() {
          this.showConfirmation = false;
          this.confirmationMessage = '';
        },
        // Quote methods
        viewQuoteDetail(quoteId) {
          this.selectedQuoteId = quoteId;
          this.currentView = 'quote-detail';
        },
        formatMoney(amount) {
          return Number(amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        },
        getQuoteStatusColor(status) {
          const colors = {
            'Sent': '#1976D2',
            'Accepted': '#388E3C',
            'Pending': '#F57C00',
            'Declined': '#D32F2F',
            'Paid': '#2E7D32'
          };
          return colors[status] || '#212529';
        },
        populateFromLead() {
          if (this.newQuote.leadId) {
            const lead = this.leads.find(l => l.id === parseInt(this.newQuote.leadId));
            if (lead) {
              this.newQuote.customerName = lead.name;
              this.newQuote.phone = lead.phone;
              this.newQuote.email = lead.email;
              this.newQuote.serviceType = lead.serviceType;
            }
          }
        },
        saveQuote() {
          // Validate required fields
          if (!this.newQuote.customerName.trim() || !this.newQuote.phone.trim() || !this.newQuote.serviceType.trim() || !this.newQuote.description.trim() || !this.newQuote.amount) {
            this.showToast('Please fill in all required fields');
            return;
          }

          const amount = parseFloat(this.newQuote.amount);
          if (isNaN(amount) || amount <= 0) {
            this.showToast('Please enter a valid amount');
            return;
          }

          // Calculate next quote number
          const maxNumber = this.quotes.length > 0 ? Math.max(...this.quotes.map(q => parseInt(q.number))) : 1000;
          const nextNumber = (maxNumber + 1).toString();

          // Set valid until date if not provided (30 days from now)
          let validUntil = this.newQuote.validUntil;
          if (!validUntil) {
            const date = new Date();
            date.setDate(date.getDate() + 30);
            validUntil = date.toISOString();
          } else {
            validUntil = new Date(validUntil).toISOString();
          }

          // Create new quote
          const quote = {
            id: this.quotes.length + 1,
            number: nextNumber,
            customerName: this.newQuote.customerName,
            phone: this.newQuote.phone,
            email: this.newQuote.email || 'N/A',
            serviceType: this.newQuote.serviceType,
            status: 'Sent',
            dateCreated: new Date().toISOString(),
            validUntil: validUntil,
            lineItems: [
              { description: this.newQuote.description, quantity: 1, price: amount }
            ],
            total: amount,
            notes: this.newQuote.notes
          };

          this.quotes.unshift(quote);
          this.showToast('Quote created successfully!');
          this.currentView = 'quotes';
          this.resetNewQuote();
        },
        cancelAddQuote() {
          this.currentView = 'quotes';
          this.resetNewQuote();
        },
        resetNewQuote() {
          this.newQuote = {
            leadId: '',
            customerName: '',
            phone: '',
            email: '',
            serviceType: '',
            description: '',
            amount: '',
            validUntil: '',
            notes: ''
          };
        },
        markQuoteStatus(status) {
          if (this.selectedQuote) {
            this.selectedQuote.status = status;
            this.showToast(`Quote marked as ${status}`);
          }
        },
        sendQuoteFollowUp() {
          if (this.selectedQuote) {
            this.confirmationMessage = `Follow-up email sent to ${this.selectedQuote.customerName} regarding Quote #${this.selectedQuote.number}`;
            this.showConfirmation = true;
          }
        },
        requestPayment() {
          if (this.selectedQuote) {
            this.confirmationMessage = `Payment request sent to ${this.selectedQuote.customerName} for $${this.formatMoney(this.selectedQuote.total)}`;
            this.showConfirmation = true;
          }
        }
      }
    }).mount('#app');
  </script>
</body>
</html>
